import{r as i,j as e,H as T}from"./app-BUl2XNVK.js";import{C as A,A as O}from"./driver-TOg9fbSz.js";import{a as L,B as c}from"./createLucideIcon-nQgsIK04.js";import{T as M,a as d}from"./ToolCard-DUmtgb5y.js";import{F as R}from"./FileUploadZone-Dme-ExYg.js";import{P as v}from"./PDFButton-hZ4qujXN.js";import{C as H}from"./circle-alert-DVH5G-gN.js";import{F as z}from"./file-text-CLErbyE6.js";import{C as I}from"./circle-check-big-D3LO5hBg.js";import{D as _}from"./download-DCCcjE2b.js";import{U as D}from"./upload-BNlRWnz8.js";import{L as V}from"./loader-circle-DdpJ5jv-.js";import"./app-Cr7akxs5.js";import"./badge-ClX4IzPs.js";import"./arrow-left-C3I9wMLH.js";import"./building-2-DsJ5nUpW.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const W=[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 9.9-1",key:"1mm8w8"}]],P=L("LockOpen",W);function me(){const[a,h]=i.useState(null),[u,p]=i.useState(!1),[F,x]=i.useState(!1),[n,f]=i.useState(""),[g,o]=i.useState(""),[w,m]=i.useState(""),[Z,$]=i.useState(!1),N=i.useRef(null),k=()=>{O({showProgress:!0,popoverClass:"driverjs-theme",prevBtnText:"Anterior",nextBtnText:"Siguiente",doneBtnText:"Finalizar",steps:[{element:'[data-tour="upload"]',popover:{title:"Paso 1: Subir PDF Protegido",description:"Selecciona el archivo PDF que está protegido con contraseña. El sistema detectará automáticamente si tiene restricciones.",side:"right",align:"start"}},{element:'[data-tour="actions"]',popover:{title:"Paso 2: Desbloquear PDF",description:'Haz clic en "Desbloquear PDF" para remover las restricciones. El archivo se descargará sin protección.',side:"left",align:"start"}}]}).drive()},j=s=>{const t=s[0];if(t){if(t.type!=="application/pdf"){o("Por favor selecciona un archivo PDF válido.");return}if(t.size>50*1024*1024){o("El archivo es demasiado grande. Máximo 50MB permitido.");return}h(t),o(""),m(""),x(!1),f("")}},y=async()=>{if(a){p(!0),o(""),m("");try{const s=await a.arrayBuffer();let t;try{t=await v.load(s,{ignoreEncryption:!0,updateMetadata:!1})}catch(l){if(l.message?.includes("password")||l.message?.includes("encrypted")){o("Este PDF está protegido con contraseña de usuario. No se puede desbloquear sin la contraseña correcta."),p(!1);return}throw l}const r=await v.create(),C=t.getPageCount();(await r.copyPages(t,Array.from({length:C},(l,B)=>B))).forEach(l=>{r.addPage(l)}),r.setTitle(t.getTitle()||""),r.setAuthor(t.getAuthor()||""),r.setSubject(t.getSubject()||""),r.setCreator("Evaristools - Hospital Universitario del Valle"),r.setProducer("Evaristools PDF Unlocker"),r.setCreationDate(new Date),r.setModificationDate(new Date);const q=await r.save(),S=new Blob([q],{type:"application/pdf"}),U=URL.createObjectURL(S);f(U),x(!0),m("Se eliminaron las restricciones de impresión, copia y edición. El PDF ahora está completamente desbloqueado.")}catch(s){console.error("Error unlocking PDF:",s),s.message?.includes("password")||s.message?.includes("encrypted")?o("Este PDF requiere una contraseña para abrirse. Esta herramienta solo puede desbloquear PDFs con restricciones de impresión/copia pero sin contraseña de usuario."):o("Error al desbloquear el PDF. El archivo puede estar corrupto o tener una protección no soportada.")}finally{p(!1)}}},E=()=>{if(!n||!a)return;const s=document.createElement("a");s.href=n,s.download=`${a.name.replace(".pdf","")}_desbloqueado.pdf`,document.body.appendChild(s),s.click(),document.body.removeChild(s)},b=()=>{h(null),x(!1),f(""),o(""),m(""),n&&URL.revokeObjectURL(n)};return e.jsxs(e.Fragment,{children:[e.jsx(T,{title:"Desbloquear PDF - Evaristools"}),e.jsxs("div",{className:"min-h-screen bg-white dark:bg-slate-900",children:[e.jsx(M,{title:"Desbloquear PDF",description:"Elimina restricciones de impresión, copia y edición de documentos PDF",icon:P}),e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsx("div",{className:"max-w-6xl mx-auto",children:e.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-2 gap-8",children:[e.jsxs("div",{className:"space-y-6","data-tour":"upload",children:[!a&&e.jsxs(d,{title:"Seleccionar PDF",children:[e.jsx(R,{onFileSelect:j,acceptedTypes:".pdf",title:"Arrastra tu PDF aquí",subtitle:"o haz clic para seleccionar (máximo 50MB)"}),e.jsx("input",{ref:N,type:"file",accept:".pdf",onChange:s=>s.target.files&&j(s.target.files),className:"hidden"})]}),g&&e.jsx(d,{title:"Error",children:e.jsxs("div",{className:"flex items-start space-x-3 p-4 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg",children:[e.jsx(H,{className:"h-5 w-5 text-red-600 mt-0.5 flex-shrink-0"}),e.jsx("p",{className:"text-red-800 dark:text-red-200",children:g})]})}),a&&e.jsx(d,{title:"Archivo Seleccionado",children:e.jsx("div",{className:"flex items-center justify-between p-4 bg-slate-50 dark:bg-slate-800 rounded-lg",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(z,{className:"h-8 w-8 text-institutional"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-slate-900 dark:text-white",children:a.name}),e.jsxs("p",{className:"text-sm text-slate-600 dark:text-slate-300",children:[(a.size/1024/1024).toFixed(2)," MB"]})]})]})})}),F&&n&&e.jsx(d,{title:"¡PDF Desbloqueado Exitosamente!",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-center space-x-3 p-6 bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-lg",children:[e.jsx(I,{className:"h-8 w-8 text-green-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-green-800 dark:text-green-200",children:"¡El PDF se desbloqueó correctamente!"}),e.jsx("p",{className:"text-sm text-green-600 dark:text-green-300",children:w})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsxs(c,{onClick:E,className:"flex-1 bg-green-600 hover:bg-green-700 text-white",children:[e.jsx(_,{className:"mr-2 h-4 w-4"}),"Descargar PDF Desbloqueado"]}),e.jsxs(c,{onClick:b,variant:"outline",className:"flex-1",children:[e.jsx(D,{className:"mr-2 h-4 w-4"}),"Desbloquear Otro PDF"]})]})]})})]}),e.jsx("div",{className:"space-y-6",children:e.jsxs(d,{title:"Acciones","data-tour":"actions",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsx(c,{onClick:y,disabled:u||!a,className:"flex-1 bg-institutional hover:bg-institutional/90",children:u?e.jsxs(e.Fragment,{children:[e.jsx(V,{className:"mr-2 h-4 w-4 animate-spin"}),"Desbloqueando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(P,{className:"mr-2 h-4 w-4"}),"Desbloquear PDF"]})}),e.jsxs(c,{onClick:b,variant:"outline",className:"flex-1",disabled:u,children:[e.jsx(D,{className:"mr-2 h-4 w-4"}),"Seleccionar Otro PDF"]})]}),e.jsxs(c,{onClick:k,variant:"outline",className:"w-full border-institutional text-institutional hover:bg-institutional/10",children:[e.jsx(A,{className:"mr-2 h-4 w-4"}),"¿Cómo funciona? - Tour Interactivo"]})]})})]})})})]})]})}export{me as default};
