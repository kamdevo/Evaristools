import{r,j as e,H as O,a as M}from"./app-CPNA5fkj.js";import{a as z,B as m}from"./createLucideIcon-CNZUbRUR.js";import{I as p}from"./input-CaIiDfhq.js";import{L as x}from"./label-Df9ZlVEi.js";import{T as U,a as n}from"./ToolCard-DvrNwqcD.js";import{F as q}from"./FileUploadZone-Bf4dPOuB.js";import{C as H,A as _}from"./driver-XYzfMZAG.js";import{F as D}from"./file-text-B0fBpE6E.js";import{C as J}from"./circle-alert-Z29hfl0A.js";import{C as S}from"./circle-check-big-CW96IzkE.js";import{L as K}from"./loader-circle-Brj18nMe.js";import{U as E}from"./upload-B_bVGoQi.js";import"./app-Cr7akxs5.js";import"./index-CRnDzTJV.js";import"./badge-kZYjAK_4.js";import"./arrow-left-DbcVuJzq.js";import"./building-2-DNyTMdoQ.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const X=[["path",{d:"m18 5-2.414-2.414A2 2 0 0 0 14.172 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2",key:"142zxg"}],["path",{d:"M21.378 12.626a1 1 0 0 0-3.004-3.004l-4.01 4.012a2 2 0 0 0-.506.854l-.837 2.87a.5.5 0 0 0 .62.62l2.87-.837a2 2 0 0 0 .854-.506z",key:"2t3380"}],["path",{d:"M8 18h1",key:"13wk12"}]],Z=z("FilePenLine",X);function me(){const[i,g]=r.useState(null),[o,j]=r.useState(null),[c,v]=r.useState(""),[F,N]=r.useState(""),[b,P]=r.useState(""),[f,C]=r.useState(!1),[T,u]=r.useState(!1),[w,s]=r.useState(""),L=r.useRef(null),A=r.useRef(null),B=()=>{_({showProgress:!0,popoverClass:"driverjs-theme",prevBtnText:"Anterior",nextBtnText:"Siguiente",doneBtnText:"Finalizar",steps:[{element:'[data-tour="upload"]',popover:{title:"Paso 1: Subir PDF",description:"Selecciona el archivo PDF que deseas firmar digitalmente.",side:"right",align:"start"}},{element:'[data-tour="certificate"]',popover:{title:"Paso 2: Subir Certificado",description:"Sube tu certificado digital (.pfx, .p12 o .pem) y ingresa la contraseña.",side:"left",align:"start"}},{element:'[data-tour="actions"]',popover:{title:"Paso 3: Firmar PDF",description:'Haz clic en "Firmar PDF" para agregar tu firma al documento. El archivo se descargará automáticamente.',side:"left",align:"start"}}]}).drive()},y=a=>{const t=a[0];if(t){if(t.type!=="application/pdf"){s("Por favor selecciona un archivo PDF válido.");return}if(t.size>50*1024*1024){s("El archivo PDF es demasiado grande. Máximo 50MB permitido.");return}g(t),s(""),u(!1)}},R=a=>{const t=a.target.files?.[0];if(!t)return;const h=[".pfx",".p12",".pem"],d=t.name.substring(t.name.lastIndexOf(".")).toLowerCase();if(!h.includes(d)){s("Por favor selecciona un certificado válido (.pfx, .p12 o .pem).");return}if(t.size>5*1024*1024){s("El certificado es demasiado grande. Máximo 5MB permitido.");return}j(t),s("")},I=async()=>{if(!i||!o||!c){s("Por favor completa todos los campos requeridos.");return}C(!0),s("");try{const a=new FormData;a.append("pdf",i),a.append("certificate",o),a.append("password",c),a.append("signer_name",F||"Firmante"),a.append("reason",b||"Firma digital");const t=await M.post("/tools/sign-pdf/sign",a,{headers:{"Content-Type":"multipart/form-data","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||""},responseType:"blob",timeout:12e4}),h=new Blob([t.data],{type:"application/pdf"}),d=window.URL.createObjectURL(h),l=document.createElement("a");l.href=d,l.download=`${i.name.replace(".pdf","")}_firmado.pdf`,document.body.appendChild(l),l.click(),document.body.removeChild(l),window.URL.revokeObjectURL(d),u(!0)}catch(a){console.error("Error signing PDF:",a);let t="Error al firmar el documento.";a.response?.status===404?t="La función de firma de PDF requiere configuración adicional en el servidor. Contacta al administrador.":a.response?.status===400?t=a.response?.data?.error||"Contraseña incorrecta o certificado inválido.":a.response?.status===500?t=a.response?.data?.error||"Error en el servidor al firmar el PDF.":a.code==="ECONNABORTED"&&(t="La firma está tardando demasiado. Intenta con un archivo más pequeño."),s(t)}finally{C(!1)}},k=()=>{g(null),j(null),v(""),N(""),P(""),u(!1),s("")};return e.jsxs(e.Fragment,{children:[e.jsx(O,{title:"Firmar PDF - Evaristools"}),e.jsxs("div",{className:"min-h-screen bg-white dark:bg-slate-900",children:[e.jsx(U,{title:"Firmar PDF",description:"Añade firmas digitales legalmente válidas a tus documentos PDF",icon:D}),e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsx("div",{className:"max-w-6xl mx-auto",children:e.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-2 gap-8",children:[e.jsxs("div",{className:"space-y-6",children:[!i&&e.jsxs(n,{title:"Seleccionar PDF a Firmar","data-tour":"upload",children:[e.jsx(q,{onFileSelect:y,acceptedTypes:".pdf",title:"Arrastra tu PDF aquí",subtitle:"o haz clic para seleccionar (máximo 50MB)"}),e.jsx("input",{ref:L,type:"file",accept:".pdf",onChange:a=>a.target.files&&y(a.target.files),className:"hidden"})]}),w&&e.jsx(n,{title:"Error",children:e.jsxs("div",{className:"flex items-start space-x-3 p-4 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg",children:[e.jsx(J,{className:"h-5 w-5 text-red-600 mt-0.5 flex-shrink-0"}),e.jsx("p",{className:"text-red-800 dark:text-red-200",children:w})]})}),i&&e.jsx(n,{title:"Archivo PDF Seleccionado",children:e.jsx("div",{className:"flex items-center justify-between p-4 bg-slate-50 dark:bg-slate-800 rounded-lg",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(D,{className:"h-8 w-8 text-institutional"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-slate-900 dark:text-white",children:i.name}),e.jsxs("p",{className:"text-sm text-slate-600 dark:text-slate-300",children:[(i.size/1024/1024).toFixed(2)," MB"]})]})]})})})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsx(n,{title:"Certificado Digital","data-tour":"certificate",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(x,{htmlFor:"certificate",children:"Subir Certificado (.pfx, .p12, .pem) *"}),e.jsxs("div",{className:"mt-2 flex items-center gap-2",children:[e.jsx(p,{ref:A,id:"certificate",type:"file",accept:".pfx,.p12,.pem",onChange:R,className:"flex-1"}),o&&e.jsx(S,{className:"h-5 w-5 text-green-600"})]}),o&&e.jsxs("p",{className:"text-sm text-green-600 dark:text-green-400 mt-1",children:["✓ ",o.name]})]}),e.jsxs("div",{children:[e.jsx(x,{htmlFor:"password",children:"Contraseña del Certificado *"}),e.jsx(p,{id:"password",type:"password",value:c,onChange:a=>v(a.target.value),placeholder:"Ingresa la contraseña de tu certificado",className:"mt-2"})]})]})}),e.jsx(n,{title:"Detalles de la Firma (Opcional)",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(x,{htmlFor:"signer-name",children:"Nombre del Firmante"}),e.jsx(p,{id:"signer-name",type:"text",value:F,onChange:a=>N(a.target.value),placeholder:"Ej: Juan Pérez",className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(x,{htmlFor:"reason",children:"Motivo de la Firma"}),e.jsx(p,{id:"reason",type:"text",value:b,onChange:a=>P(a.target.value),placeholder:"Ej: Aprobación de documento",className:"mt-2"})]})]})}),e.jsxs(n,{title:"Acciones","data-tour":"actions",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsx(m,{onClick:I,disabled:f||!o||!c,className:"flex-1 bg-institutional hover:bg-institutional/90",children:f?e.jsxs(e.Fragment,{children:[e.jsx(K,{className:"mr-2 h-4 w-4 animate-spin"}),"Firmando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Z,{className:"mr-2 h-4 w-4"}),"Firmar PDF"]})}),e.jsxs(m,{onClick:k,variant:"outline",className:"flex-1",disabled:f,children:[e.jsx(E,{className:"mr-2 h-4 w-4"}),"Seleccionar Otro"]})]}),e.jsxs(m,{onClick:B,variant:"outline",className:"w-full border-institutional text-institutional hover:bg-institutional/10",children:[e.jsx(H,{className:"mr-2 h-4 w-4"}),"¿Cómo funciona? - Tour Interactivo"]})]}),T&&e.jsx(n,{title:"¡PDF Firmado Exitosamente!",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-center space-x-3 p-6 bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-lg",children:[e.jsx(S,{className:"h-8 w-8 text-green-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-green-800 dark:text-green-200",children:"¡El PDF se firmó digitalmente y se descargó!"}),e.jsx("p",{className:"text-sm text-green-600 dark:text-green-300",children:"El archivo ahora contiene tu firma digital verificable."})]})]}),e.jsxs(m,{onClick:k,variant:"outline",className:"w-full",children:[e.jsx(E,{className:"mr-2 h-4 w-4"}),"Firmar Otro PDF"]})]})})]})]})})})]})]})}export{me as default};
